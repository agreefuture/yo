use ":C/string";
use ":std/memory";

struct String {
    ptr: *i8,
    len: size_t
}

impl String {
    fn init(self: &String, ptr: *i8) {
        self.ptr = strdup(ptr);
        self.len = strlen(ptr);
    }

    fn init(self: &String, other: &String) {
        self.ptr = strdup(other.ptr);
        self.len = other.len;
    }

    fn c_str(self: &String) -> *i8 {
        return self.ptr;
    }

    fn length(self: &String) -> size_t {
        return self.len;
    }

    fn append(self: &String, other: String) {
        let newLength = self.len + other.len;
        let newPtr = alloc<i8>(newLength + 1);
        memcpy(newPtr, self.ptr, self.len);
        memcpy(newPtr + self.len, other.ptr, other.len);
        newPtr[newLength] = '\0';
        free(self.ptr);
        self.ptr = newPtr;
        self.len = newLength;
    }

    fn print_desc(self: &String) {
        printf(b"[String ptr: %p len: %lli text: %s]\n", self.ptr, self.len, self.ptr);
    }

    fn dealloc(self: &String) {
        // TODO;
        printf(b"%s\n", __pretty_func());
        free(self.ptr);
    }
}
